<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body, html {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            position: relative;
        }
        .chessboard-container {
            position: relative;
            width: min(90vmin, 90vw);
            height: min(90vmin, 90vw);
        }
        table {
            border-collapse: collapse;
            width: 100%;
            height: 100%;
        }
        td {
            width: 12.5%;
            height: 12.5%;
            text-align: center;
            vertical-align: middle;
            position: relative;
        }
        .light {
            background-color: #f0d9b5;
        }
        .dark {
            background-color: #b58863;
        }
        .label {
            position: absolute;
            font-weight: bold;
        }
        .row-label {
            left: -2.5%;
            top: calc(12.5% * var(--row) - 6.25%);
            transform: translateY(-50%);
        }
        .col-label {
            top: -3%;
            left: calc(12.5% * var(--col) - 6.25%);
            transform: translateX(-50%);
        }
        .piece {
            position: absolute;
            width: 80%;
            height: 80%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .highlight {
            border: 2px solid yellow; /* Zvýraznění cílové buňky */
        }
    </style>
    <title>Šachovnice</title>
</head>
<body>

<div class="chessboard-container" id="chessboard-container">
    <table id="chessboard"></table>
</div>

<script>
    let currentPlayer = 'white'; // 'white' or 'black'
    let selectedPiece = null;


    function vytvorenisachovnice() {
        const table = document.getElementById('chessboard');
        const container = document.getElementById('chessboard-container');
        const letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];

        // Generování šachovnice
        for (let i = 1; i <= 8; i++) {
            let row = table.insertRow();
            for (let j = 1; j <= 8; j++) {
                let cell = row.insertCell();
                cell.className = (i + j) % 2 === 0 ? 'light' : 'dark'; //střídání barev s použitím dělení bez zbytku
                cell.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                cell.addEventListener('drop', (e) => {
                    e.preventDefault();
                    handleDrop(e);
                });

                cell.addEventListener('click', () => {
                    handleCellClick(cell);
                });
            }
        }
        // Rozmístění figurek
            //vytvoření konstatny pozic na začátku dle nazvu figurky - tedy mapa rozmístění na start
        const pieces = [
            { type: 'bily_pesak', positions: Array.from({length: 8}, (_, i) => `2-${i+1}`) },
            { type: 'cerny_pesak', positions: Array.from({length: 8}, (_, i) => `7-${i+1}`) },
            { type: 'bily_vez', positions: ['1-1', '1-8'] },
            { type: 'cerny_vez', positions: ['8-1', '8-8'] },
            { type: 'bily_kun', positions: ['1-2', '1-7'] },
            { type: 'cerny_kun', positions: ['8-2', '8-7'] },
            { type: 'bily_strelec', positions: ['1-3', '1-6'] },
            { type: 'cerny_strelec', positions: ['8-3', '8-6'] },
            { type: 'bily_dama', positions: ['1-4'] },
            { type: 'cerny_dama', positions: ['8-4'] },
            { type: 'bily_kral', positions: ['1-5'] },
            { type: 'cerny_kral', positions: ['8-5'] }
        ];

        pieces.forEach(piece => {
            piece.positions.forEach(position => {
                const [row, col] = position.split('-').map(Number);
                const cell = table.rows[row - 1].cells[col - 1];
                const img = document.createElement('img');
                img.src = `images/${piece.type}.svg`; // Cesta k SVG souboru - dle jednotlivých názvů ${pieces.type}
                img.className = 'piece';
                img.draggable = true;
                img.dataset.position = position;
                img.dataset.color = piece.type.startsWith('bily') ? 'white' : 'black';
                img.addEventListener('dragstart', (e) => {
                    selectedPiece = e.target;
                });                
                cell.appendChild(img);
            });
        });

        // Přidání souřadnic písmen (řádky)
        letters.forEach((letter, index) => {
            const label = document.createElement('div');
            label.textContent = letter;
            label.className = 'label row-label';
            label.style.setProperty('--row', index + 1);
            container.appendChild(label);
        });

        // Přidání souřadnic čísel (sloupce)
        for (let i = 1; i <= 8; i++) {
            const label = document.createElement('div');
            label.textContent = i;
            label.className = 'label col-label';
            label.style.setProperty('--col', i);
            container.appendChild(label);
        }
    }
    function handleCellClick(cell) {
        if (selectedPiece) {
            const cellPos = getCellPosition(cell);
            const piecePos = selectedPiece.dataset.position.split('-').map(Number);

            // Zjednodušená kontrola, zda je tah platný
            if (isValidMove(piecePos, cellPos)) {
                movePiece(selectedPiece, cell);
                currentPlayer = currentPlayer === 'white' ? 'black' : 'white'; // Střídání tahů
            }
            selectedPiece = null;
            clearHighlights();
        } else {
            // Pokud není žádná figurka vybraná, vybereme tuto
            if (cell.querySelector('.piece')) {
                selectedPiece = cell.querySelector('.piece');
                const piecePos = selectedPiece.dataset.position.split('-').map(Number);
                highlightPossibleMoves(piecePos);
            }
        }
    }

    function handleDrop(e) {
        if (selectedPiece) {
            const cell = e.target.closest('td');
            if (cell && isValidMove(getCellPosition(selectedPiece.parentElement), getCellPosition(cell))) {
                movePiece(selectedPiece, cell);
                currentPlayer = currentPlayer === 'white' ? 'black' : 'white'; // Střídání tahů
            }
            selectedPiece = null;
            clearHighlights();
        }
    }
    function highlightPossibleMoves(position) {
    const [row, col] = position;
    const table = document.getElementById('chessboard');

        // Vyčistit předchozí zvýraznění
        clearHighlights();

        // Příklad: Zvýraznit všechny sousední buňky (8 směrů)
        for (let r = row - 1; r <= row + 1; r++) {
            for (let c = col - 1; c <= col + 1; c++) {
                if (r >= 1 && r <= 8 && c >= 1 && c <= 8 && (r !== row || c !== col)) {
                    const cell = table.rows[r - 1].cells[c - 1];
                    cell.classList.add('highlight');
                }
            }
        }
    }


    function movePiece(piece, targetCell) {
        targetCell.appendChild(piece);
        piece.dataset.position = getCellPosition(targetCell).join('-');
    }

    function getCellPosition(cell) {
        const row = cell.parentElement.rowIndex + 1;
        const col = cell.cellIndex + 1;
        return [row, col];
    }

    function isValidMove(fromPos, toPos) {
        // Implementace logiky pro validaci pohybu podle pravidel šachu
        return true; // Zjednodušené - zde je nutné přidat pravidla pro různé figurky
    }

    function clearHighlights() {
        document.querySelectorAll('.highlight').forEach(cell => cell.classList.remove('highlight'));
    }

    document.addEventListener('DOMContentLoaded', () => {
        vytvorenisachovnice();
    });
</script>

</body>
</html>
